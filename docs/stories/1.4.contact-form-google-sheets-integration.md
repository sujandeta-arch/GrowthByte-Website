# User Story: Contact Form Google Sheets Integration

**Story ID:** 1.4  
**Priority:** üî¥ URGENT  
**Status:** Ready for Review  
**Assigned:** Bhargav  
**Created:** 2024

---

## Story Description

As a **website visitor**, I want to **submit the contact form and receive confirmation**, so that I know my inquiry was received and the GrowthByte team can follow up with me.

As a **GrowthByte team member**, I want to **receive contact form submissions stored in Google Sheets**, so that I can access all leads in one place and respond to potential clients promptly.

---

## Business Context

The contact form on `/contact` page currently does not persist or send data anywhere. We want to keep the existing custom-designed form (not use Google Forms embed) but store all submissions in Google Sheets for easy access and management.

---

## Requirements

### 1. Keep Existing Contact Form

**Action:** Keep the current contact form design and UI in `app/contact/page.tsx`

**Form Fields:**
- Full Name (required)
- Email Address (required)
- Company Name (required)
- Service Interest (required - dropdown)
- Phone Number (optional)
- Message/Goals (optional)

**User Experience:**
- Form maintains current design and styling
- Form shows success/error states
- Form validates required fields
- Form shows loading state during submission

---

### 2. Store Submissions in Google Sheets

**When:** User submits contact form with valid data

**Action:** Form data is automatically saved to a Google Sheet

**Sheet Structure:**
- Column A: Timestamp
- Column B: Full Name
- Column C: Email Address
- Column D: Company Name
- Column E: Service Interest
- Column F: Phone Number
- Column G: Message/Goals

**Benefits:**
- All submissions in one place
- Easy to export, analyze, or integrate with other tools
- Can set up email notifications from Google Sheets
- Historical data preserved

---

### 3. Form User Experience

**Success State:**
- Display clear success message: "Thank you! We've received your message. We'll get back to you within 24 hours."
- Clear or disable form fields
- Show success indicator

**Error State:**
- Display clear error message if submission fails
- Provide fallback: "If you continue to experience issues, please email us directly at harsha@thinkbyte.ai"
- Preserve user's form data if possible

**Loading State:**
- Show loading indicator while form is submitting
- Disable submit button during submission

---

## Technical Requirements

### Implementation Approach

**Option 1: Google Apps Script Webhook (Recommended)**

1. **Create Google Apps Script:**
   - Create a Google Apps Script that receives POST data
   - Script writes data to Google Sheet
   - Deploy as web app to get a webhook URL

2. **Create API Route:**
   - File: `app/api/contact/route.ts`
   - Method: `POST`
   - Validate form data
   - Send data to Google Apps Script webhook
   - Return success/error response

3. **Update Contact Form:**
   - Convert form to client component (or extract to separate component)
   - Add form submission handler
   - Add loading/success/error states
   - Call API route on submit

**Option 2: Google Sheets API (Alternative)**

1. **Set up Google Service Account:**
   - Create service account in Google Cloud Console
   - Enable Google Sheets API
   - Generate credentials JSON
   - Share Google Sheet with service account email

2. **Create API Route:**
   - File: `app/api/contact/route.ts`
   - Use `googleapis` npm package
   - Authenticate with service account
   - Write data directly to Google Sheet

3. **Update Contact Form:**
   - Same as Option 1

**Recommendation:** Option 1 (Google Apps Script) is simpler and doesn't require service account setup.

---

## Implementation Steps

### Step 1: Create Google Sheet

1. Go to Google Sheets
2. Create new spreadsheet
3. Name it: "GrowthByte Contact Form Submissions"
4. Set up headers in Row 1:
   - A1: Timestamp
   - B1: Full Name
   - C1: Email Address
   - D1: Company Name
   - E1: Service Interest
   - F1: Phone Number
   - G1: Message/Goals
5. Share sheet with the Google account that will create the Apps Script (if different)

### Step 2: Create Google Apps Script Webhook

1. In Google Sheet, go to Extensions ‚Üí Apps Script
2. Create new script with the following code:

```javascript
function doPost(e) {
  try {
    // Parse the incoming data
    const data = JSON.parse(e.postData.contents);
    
    // Get the active spreadsheet
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    
    // Append the data as a new row
    sheet.appendRow([
      new Date(), // Timestamp
      data.name || '',
      data.email || '',
      data.company || '',
      data.service || '',
      data.phone || '',
      data.message || ''
    ]);
    
    // Return success response
    return ContentService
      .createTextOutput(JSON.stringify({ success: true }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    // Return error response
    return ContentService
      .createTextOutput(JSON.stringify({ success: false, error: error.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
```

3. Save the script
4. Deploy as web app:
   - Click "Deploy" ‚Üí "New deployment"
   - Type: "Web app"
   - Execute as: "Me"
   - Who has access: "Anyone" (or "Anyone with Google account" for more security)
   - Click "Deploy"
   - Copy the web app URL (this is your webhook URL)

### Step 3: Create Next.js API Route

Create `app/api/contact/route.ts`:

```typescript
import { NextRequest, NextResponse } from 'next/server'

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    
    // Validate required fields
    if (!body.name || !body.email || !body.company || !body.service) {
      return NextResponse.json(
        { success: false, error: 'Missing required fields' },
        { status: 400 }
      )
    }
    
    // Validate email format
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    if (!emailRegex.test(body.email)) {
      return NextResponse.json(
        { success: false, error: 'Invalid email address' },
        { status: 400 }
      )
    }
    
    // Send to Google Apps Script webhook
    const webhookUrl = process.env.GOOGLE_APPS_SCRIPT_WEBHOOK_URL
    
    if (!webhookUrl) {
      console.error('GOOGLE_APPS_SCRIPT_WEBHOOK_URL not configured')
      return NextResponse.json(
        { success: false, error: 'Server configuration error' },
        { status: 500 }
      )
    }
    
    const response = await fetch(webhookUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        name: body.name,
        email: body.email,
        company: body.company,
        service: body.service,
        phone: body.phone || '',
        message: body.message || '',
      }),
    })
    
    if (!response.ok) {
      throw new Error('Failed to save to Google Sheets')
    }
    
    const result = await response.json()
    
    if (!result.success) {
      throw new Error(result.error || 'Failed to save data')
    }
    
    return NextResponse.json({ success: true })
    
  } catch (error) {
    console.error('Contact form error:', error)
    return NextResponse.json(
      { success: false, error: 'Failed to submit form. Please try again or email us directly.' },
      { status: 500 }
    )
  }
}
```

### Step 4: Update Contact Form

Update `app/contact/page.tsx` to make the form functional:

1. Convert to client component or extract form to separate client component
2. Add form state management (useState)
3. Add form submission handler
4. Add loading/success/error states
5. Call API route on submit

**Example form handler structure:**

```typescript
'use client'

import { useState } from 'react'

export default function ContactPage() {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    company: '',
    service: '',
    phone: '',
    message: '',
  })
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [submitStatus, setSubmitStatus] = useState<'idle' | 'success' | 'error'>('idle')
  const [errorMessage, setErrorMessage] = useState('')

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setIsSubmitting(true)
    setSubmitStatus('idle')
    setErrorMessage('')

    try {
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData),
      })

      const result = await response.json()

      if (result.success) {
        setSubmitStatus('success')
        // Clear form
        setFormData({
          name: '',
          email: '',
          company: '',
          service: '',
          phone: '',
          message: '',
        })
      } else {
        setSubmitStatus('error')
        setErrorMessage(result.error || 'Failed to submit form')
      }
    } catch (error) {
      setSubmitStatus('error')
      setErrorMessage('Failed to submit form. Please try again or email us directly at harsha@thinkbyte.ai')
    } finally {
      setIsSubmitting(false)
    }
  }

  // ... rest of component with form JSX
}
```

### Step 5: Environment Variables

Add to `.env.local`:
```
GOOGLE_APPS_SCRIPT_WEBHOOK_URL=https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec
```

Add to deployment platform (Vercel/Netlify) environment variables with the same key.

---

## Acceptance Criteria

### ‚úÖ Must Have

- [ ] Contact form maintains existing design and styling
- [ ] Form submission saves data to Google Sheets
- [ ] All form fields (name, email, company, service, phone, message) are saved
- [ ] Timestamp is automatically added to each submission
- [ ] Form shows success message after successful submission
- [ ] Form shows error message if submission fails
- [ ] Form validates required fields (name, email, company, service)
- [ ] Form shows loading state during submission
- [ ] Form works in production environment

### ‚úÖ Should Have

- [ ] Form fields clear after successful submission
- [ ] Error message includes fallback contact method
- [ ] Form is accessible (keyboard navigation, screen readers)
- [ ] Form works on mobile devices

### ‚úÖ Nice to Have

- [ ] Email notifications from Google Sheets (can be set up separately)
- [ ] Form data validation (email format, etc.)
- [ ] Rate limiting to prevent spam

---

## Testing Checklist

- [ ] Test form submission with all fields filled
- [ ] Test form submission with only required fields
- [ ] Test form submission with invalid email
- [ ] Test form submission with missing required fields
- [ ] Verify data appears in Google Sheets
- [ ] Verify timestamp is correct in Google Sheets
- [ ] Test form on mobile device
- [ ] Test form on desktop
- [ ] Test form in different browsers
- [ ] Test error handling (wrong webhook URL, network error)
- [ ] Test form in production environment

---

## Dependencies

- **Google Account:** Need Google account to create Sheet and Apps Script
- **Google Apps Script:** Free, no additional cost
- **NPM Package:** None required (uses native fetch API)
- **Environment Variable:** `GOOGLE_APPS_SCRIPT_WEBHOOK_URL`

---

## Security Considerations

1. **Webhook URL:** Keep in environment variables, never commit to git
2. **Access Control:** Set Google Apps Script deployment to "Anyone with Google account" for basic security, or implement API key authentication
3. **Rate Limiting:** Consider adding rate limiting in API route to prevent spam
4. **Input Validation:** Validate all inputs on both client and server side

---

## Related Files

- `app/contact/page.tsx` - Contact form page (needs update to add form handler)
- `app/api/contact/route.ts` - API route (to be created)
- `.env.local` - Environment variables (needs GOOGLE_APPS_SCRIPT_WEBHOOK_URL)

---

## Notes

- **Priority:** URGENT - Quick solution to get contact form working
- **Complexity:** Medium - Requires Google Apps Script setup and API route
- **Estimated Effort:** 3-4 hours (including Google Apps Script setup, API route, form handler, and testing)
- **Risk:** Low - Google Apps Script is reliable, but webhook URL needs to be kept secure

---

## Questions for Dev Team

1. Should we add rate limiting to prevent spam?
2. Do we need additional validation beyond required fields?
3. Should we add email notifications (can be done via Google Sheets triggers separately)?
4. Do we need to sanitize user input before saving to Sheets?

---

**Last Updated:** 2024  
**Story Owner:** Bhargav

---

## Status

Ready for Review

---

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (via Cursor)

### Debug Log References
N/A - Implementation completed successfully

### Completion Notes List
- ‚úÖ Created API route `app/api/contact/route.ts` with Google Apps Script webhook integration
- ‚úÖ API route validates required fields (name, email, company, service)
- ‚úÖ API route validates email format using regex
- ‚úÖ API route forwards form data to Google Apps Script webhook URL from environment variable
- ‚úÖ Created client component `app/contact/ContactForm.tsx` with form state management
- ‚úÖ Form maintains existing design and styling
- ‚úÖ Added form state management with useState hooks
- ‚úÖ Added loading state with spinner and disabled form fields during submission
- ‚úÖ Added success state with green success message banner
- ‚úÖ Added error state with red error message banner and fallback contact information
- ‚úÖ Form clears all fields after successful submission
- ‚úÖ Form validates required fields (name, email, company, service) - matches story requirements
- ‚úÖ Message field is optional (matches story requirements)
- ‚úÖ Phone field is optional (matches story requirements)
- ‚úÖ Form shows loading spinner in submit button during submission
- ‚úÖ All form fields disabled during submission to prevent double-submission
- ‚úÖ Error messages include fallback contact method (harsha@thinkbyte.ai)
- ‚úÖ No linter errors introduced
- ‚ö†Ô∏è Note: Google Apps Script webhook URL must be configured in environment variable `GOOGLE_APPS_SCRIPT_WEBHOOK_URL`
- ‚ö†Ô∏è Note: Google Sheet and Apps Script setup are manual steps (completed per story requirements)

### File List
**Created Files:**
- `app/api/contact/route.ts` - API route for handling form submissions and forwarding to Google Apps Script webhook
- `app/contact/ContactForm.tsx` - Client component with form state management and submission handler

**Modified Files:**
- `app/contact/page.tsx` - Updated to use ContactForm client component, maintains metadata and page structure

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-XX | 1.0 | Initial story creation | PM Agent |
| 2024-12-XX | 1.1 | API route and contact form implementation completed | Dev Agent (Bhargav) |
